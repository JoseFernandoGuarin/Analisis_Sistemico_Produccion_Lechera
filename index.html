<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Producci√≥n Lechera Interactivo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            padding: 30px;
        }

        .diagram-container {
            background: #f7fafc;
            border-radius: 15px;
            padding: 30px;
            position: relative;
            min-height: 1000px;
            overflow: visible;
        }

        .svg-connections {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .nodes-container {
            position: relative;
            z-index: 2;
            width: 100%;
            height: 100%;
        }

        .info-panel {
            background: #edf2f7;
            border-radius: 15px;
            padding: 25px;
            height: fit-content;
            position: sticky;
            top: 20px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .info-panel h2 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .info-panel .content {
            color: #4a5568;
            line-height: 1.8;
        }

        .node {
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            font-weight: 500;
            text-align: center;
            position: absolute;
            min-width: 140px;
            font-size: 0.9em;
        }

        .node:hover {
            transform: scale(1.08);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            z-index: 10;
        }

        .node.active {
            border-color: #fff;
            box-shadow: 0 0 0 4px rgba(255,255,255,0.6);
            z-index: 10;
        }

        /* Categor√≠as de nodos */
        .produccion {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        .reproductivo {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            color: white;
        }

        .sanitario {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
        }

        .ambiental {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
        }

        .tecnico {
            background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%);
            color: white;
        }

        .gerencial {
            background: linear-gradient(135deg, #ecc94b 0%, #d69e2e 100%);
            color: white;
        }

        .sistema-central {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 20px;
        }

        .pcc-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #f56565;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .legend {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 5px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2d3748;
        }

        .stat-label {
            color: #718096;
            font-size: 0.9em;
            margin-top: 5px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .node.pcc-node::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border-radius: 12px;
            background: rgba(245, 101, 101, 0.3);
            animation: pulse 2s infinite;
            z-index: -1;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab:hover {
            transform: translateY(-2px);
        }

        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .info-panel {
                position: relative;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üêÑ Sistema de Producci√≥n Lechera</h1>
            <p>An√°lisis Interactivo de Procesos, Puntos Cr√≠ticos y Complejidad Sist√©mica</p>
            <p>Jos√© Fernando Guarin M., Ph.D.</p>
        </header>

        <div class="main-content">
            <div class="diagram-container" id="diagram">
                <svg class="svg-connections" id="connections"></svg>
                <div class="nodes-container" id="nodes"></div>
            </div>

            <div class="info-panel">
                <div class="tabs">
                    <button class="tab active" onclick="showTab('info')">Info</button>
                    <button class="tab" onclick="showTab('stats')">Stats</button>
                </div>
                
                <div id="info-content">
                    <h2 id="info-title">Sistema de Producci√≥n</h2>
                    <div class="content" id="info-text">
                        <p>Haz clic en cualquier componente del sistema para explorar su descripci√≥n, funci√≥n y puntos cr√≠ticos de control.</p>
                        <p style="margin-top: 15px;"><strong>Componentes destacados:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>üü¢ Subsistema Productivo</li>
                            <li>üü† Subsistema Reproductivo</li>
                            <li>üî¥ Subsistema Sanitario</li>
                            <li>üîµ Factores Ambientales</li>
                            <li>üü£ Factores T√©cnicos</li>
                            <li>üü° Gerenciamiento</li>
                        </ul>
                    </div>
                </div>

                <div id="stats-content" style="display: none;">
                    <h2>Estad√≠sticas del Sistema</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">19</div>
                            <div class="stat-label">Componentes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">5</div>
                            <div class="stat-label">PCC Cr√≠ticos</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">6</div>
                            <div class="stat-label">Subsistemas</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">25+</div>
                            <div class="stat-label">Conexiones</div>
                        </div>
                    </div>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color produccion"></div>
                        <span>Productivo</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color reproductivo"></div>
                        <span>Reproductivo</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color sanitario"></div>
                        <span>Sanitario</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color ambiental"></div>
                        <span>Ambiental</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color tecnico"></div>
                        <span>T√©cnico</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color gerencial"></div>
                        <span>Gerencial</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const systemData = {
            'sistema-produccion': {
                title: 'Sistema de Producci√≥n Central',
                description: 'N√∫cleo integrador del sistema lechero. Representa el punto de convergencia donde todos los subsistemas (reproductivo, sanitario, nutricional, ambiental y t√©cnico) se sincronizan para determinar la productividad emergente. No es simplemente la suma de componentes, sino el resultado de interacciones sin√©rgicas complejas.',
                pcc: false,
                category: 'produccion'
            },
            'volumen-leche': {
                title: 'Volumen Mensual de Leche',
                description: 'Output principal del sistema. Variable objetivo que emerge de la multiplicaci√≥n entre n√∫mero de vacas en lactancia y producci√≥n individual. Representa la m√©trica econ√≥mica fundamental y constituye el indicador integrado del desempe√±o sist√©mico global.',
                pcc: false,
                category: 'produccion'
            },
            'produccion-vaca': {
                title: 'Producci√≥n por Vaca',
                description: 'Rendimiento individual que depende de: gen√©tica, nutrici√≥n, sanidad de gl√°ndula mamaria, eficiencia de orde√±o, confort ambiental y d√≠as en lactancia. Es el punto donde convergen factores intr√≠nsecos (gen√©ticos) y extr√≠nsecos (manejo).',
                pcc: true,
                category: 'produccion'
            },
            'vacas-lactancia': {
                title: 'N√∫mero de Vacas en Lactancia',
                description: 'Determinante poblacional de la producci√≥n total. Resultado del balance din√°mico entre partos, descarte y per√≠odo seco. Su gesti√≥n √≥ptima requiere sincronizaci√≥n entre tasa de reemplazo, longevidad productiva y capacidad instalada.',
                pcc: false,
                category: 'produccion'
            },
            'descarte': {
                title: 'Descarte',
                description: 'V√°lvula reguladora del sistema que remueve animales improductivos o con problemas sanitarios cr√≥nicos. Act√∫a como mecanismo de control de calidad gen√©tica y sanitaria, pero debe balancearse con costos de reemplazo.',
                pcc: false,
                category: 'reproductivo'
            },
            'tasa-celo': {
                title: 'Tasa de Observaci√≥n de Celo',
                description: 'Punto de entrada al proceso reproductivo. Depende de: expresi√≥n hormonal, nutrici√≥n, condici√≥n corporal y eficiencia del sistema de detecci√≥n. Una tasa baja (<50%) indica fallas en manejo o problemas metab√≥licos subyacentes.',
                pcc: false,
                category: 'reproductivo'
            },
            'tasa-prenez': {
                title: 'Tasa de Pre√±ez',
                description: 'Indicador de eficiencia reproductiva que integra detecci√≥n de celo, calidad seminal, t√©cnica de IA y condici√≥n uterina. Genera efecto cascada sobre estructura del hato y distribuci√≥n de partos.',
                pcc: false,
                category: 'reproductivo'
            },
            'dias-lactancia': {
                title: 'D√≠as en Lactancia',
                description: 'Variable de estado que modula producci√≥n (curva de lactancia), fertilidad (anestro posparto) y susceptibilidad a enfermedades. Su distribuci√≥n √≥ptima asegura flujo constante de leche durante el a√±o.',
                pcc: false,
                category: 'reproductivo'
            },
            'tasa-concepcion': {
                title: 'Tasa de Concepci√≥n',
                description: 'PCC que determina eficiencia del ciclo reproductivo. Tasas <35% indican problemas nutricionales (balance energ√©tico negativo), sanitarios (endometritis) o de manejo (estr√©s t√©rmico, t√©cnica de IA).',
                pcc: true,
                category: 'reproductivo'
            },
            'sanidad': {
                title: 'Sanidad General',
                description: 'Estado de homeostasis inmunol√≥gica y metab√≥lica. Conecta bidireccionalmente con todos los subsistemas. La sanidad deficiente amplifica perturbaciones y reduce resiliencia sist√©mica.',
                pcc: false,
                category: 'sanitario'
            },
            'enfermedad-reproductiva': {
                title: 'Enfermedad Reproductiva',
                description: 'Incluye: endometritis, quistes ov√°ricos, abortos. Incrementa d√≠as abiertos, reduce tasa de concepci√≥n y aumenta descarte involuntario. Frecuentemente vinculada a balance energ√©tico negativo periparto.',
                pcc: false,
                category: 'sanitario'
            },
            'enfermedad-parto': {
                title: 'Enfermedad al Parto',
                description: 'Distocias, retenci√≥n placentaria, metritis. Establece punto cr√≠tico de transici√≥n que predispone a cascada de problemas: cetosis, desplazamiento de abomaso, mastitis, baja fertilidad.',
                pcc: false,
                category: 'sanitario'
            },
            'trastornos-glandula': {
                title: 'Trastornos en Gl√°ndula Mamaria',
                description: 'PCC de m√°ximo impacto sobre producci√≥n y calidad. La mastitis reduce producci√≥n 10-40%, aumenta RCS y compromete comercializaci√≥n. Requiere enfoque multifactorial: higiene, rutina de orde√±o, inmunidad.',
                pcc: true,
                category: 'sanitario'
            },
            'trastornos-podales': {
                title: 'Trastornos Podales',
                description: 'Generan efecto multiplicador: reducen movilidad, disminuyen consumo de MS, inducen estr√©s cr√≥nico, comprometen inmunidad y fertilidad. Prevalencia >25% indica fallas en infraestructura o nutrici√≥n mineral.',
                pcc: false,
                category: 'sanitario'
            },
            'estado-nutricional': {
                title: 'Estado Nutricional',
                description: 'PCC modulador maestro del sistema. Establece sustrato metab√≥lico para producci√≥n, reproducci√≥n e inmunidad. Balance energ√©tico negativo prolongado genera cascada de patolog√≠as: cetosis, h√≠gado graso, inmunodepresi√≥n.',
                pcc: true,
                category: 'sanitario'
            },
            'factores-ambientales': {
                title: 'Factores Ambientales',
                description: 'Configuran nicho ecol√≥gico: temperatura, humedad, calidad de aire, densidad animal, dise√±o de instalaciones. Estr√©s t√©rmico (THI>72) reduce consumo 10-35% y producci√≥n hasta 50%.',
                pcc: false,
                category: 'ambiental'
            },
            'factores-tecnicos': {
                title: 'Factores T√©cnicos',
                description: 'Intervenciones antropog√©nicas: protocolos de alimentaci√≥n, rutina de orde√±o, programas sanitarios, manejo reproductivo. Representan el punto de control donde conocimiento cient√≠fico se traduce en pr√°ctica.',
                pcc: false,
                category: 'tecnico'
            },
            'gerenciamiento': {
                title: 'Gerenciamiento de la Rutina',
                description: 'PCC de control y monitoreo. Sistema de informaci√≥n que detecta desviaciones, permite decisiones basadas en datos y mantiene homeostasis. Incluye: registros, KPIs, an√°lisis de tendencias, protocolos de acci√≥n.',
                pcc: true,
                category: 'gerencial'
            },
            'sistema-cria': {
                title: 'Sistema de Cr√≠a',
                description: 'Asegura renovaci√≥n generacional y progreso gen√©tico. Determina: estructura etaria futura, calidad de reemplazos, costos de levante. Edad al primer parto √≥ptima: 24 meses.',
                pcc: false,
                category: 'gerencial'
            }
        };

        // Posiciones de los nodos (reajustadas con m√°s espacio)
        const nodePositions = {
            'descarte': { x: 180, y: 30 },
            'vacas-lactancia': { x: 180, y: 130 },
            'volumen-leche': { x: 30, y: 220 },
            'produccion-vaca': { x: 180, y: 310 },
            'tasa-celo': { x: 380, y: 30 },
            'sanidad': { x: 580, y: 30 },
            'tasa-prenez': { x: 380, y: 140 },
            'tasa-concepcion': { x: 580, y: 220 },
            'dias-lactancia': { x: 380, y: 310 },
            'sistema-produccion': { x: 530, y: 380 },
            'enfermedad-reproductiva': { x: 800, y: 100 },
            'enfermedad-parto': { x: 800, y: 200 },
            'trastornos-glandula': { x: 800, y: 300 },
            'trastornos-podales': { x: 800, y: 400 },
            'estado-nutricional': { x: 580, y: 550 },
            'factores-ambientales': { x: 800, y: 520 },
            'factores-tecnicos': { x: 800, y: 640 },
            'gerenciamiento': { x: 380, y: 700 },
            'sistema-cria': { x: 100, y: 700 }
        };

        // Conexiones del diagrama original
        const connections = [
            { from: 'descarte', to: 'vacas-lactancia' },
            { from: 'vacas-lactancia', to: 'volumen-leche' },
            { from: 'produccion-vaca', to: 'volumen-leche' },
            { from: 'sistema-cria', to: 'produccion-vaca' },
            { from: 'tasa-celo', to: 'tasa-prenez' },
            { from: 'sanidad', to: 'tasa-concepcion' },
            { from: 'sanidad', to: 'descarte' },
            { from: 'tasa-prenez', to: 'dias-lactancia' },
            { from: 'dias-lactancia', to: 'produccion-vaca' },
            { from: 'tasa-concepcion', to: 'dias-lactancia' },
            { from: 'enfermedad-reproductiva', to: 'sistema-produccion' },
            { from: 'enfermedad-parto', to: 'sistema-produccion' },
            { from: 'trastornos-glandula', to: 'sistema-produccion' },
            { from: 'trastornos-podales', to: 'sistema-produccion' },
            { from: 'estado-nutricional', to: 'sistema-produccion' },
            { from: 'factores-ambientales', to: 'sistema-produccion' },
            { from: 'factores-tecnicos', to: 'sistema-produccion' },
            { from: 'gerenciamiento', to: 'sistema-produccion' },
            { from: 'sistema-produccion', to: 'produccion-vaca' },
            { from: 'sistema-produccion', to: 'sanidad' },
            { from: 'sistema-produccion', to: 'dias-lactancia' },
            { from: 'sistema-produccion', to: 'estado-nutricional' },
            { from: 'dias-lactancia', to: 'tasa-concepcion' },
            { from: 'tasa-prenez', to: 'tasa-concepcion' }
        ];

        const nodesContainer = document.getElementById('nodes');
        const svg = document.getElementById('connections');

        // Crear nodos
        Object.keys(systemData).forEach(key => {
            const node = document.createElement('div');
            const data = systemData[key];
            const pos = nodePositions[key];
            
            node.className = `node ${data.category}${data.pcc ? ' pcc-node' : ''}`;
            node.id = key;
            node.textContent = data.title;
            node.style.left = pos.x + 'px';
            node.style.top = pos.y + 'px';
            
            if (key === 'sistema-produccion') {
                node.className += ' sistema-central';
            }
            
            if (data.pcc) {
                const badge = document.createElement('div');
                badge.className = 'pcc-badge';
                badge.textContent = 'PCC';
                node.appendChild(badge);
            }
            
            node.addEventListener('click', () => selectNode(key));
            
            nodesContainer.appendChild(node);
        });

        // Dibujar conexiones
        function drawConnections() {
            const svgNS = "http://www.w3.org/2000/svg";
            svg.innerHTML = '';
            
            connections.forEach(conn => {
                const fromNode = document.getElementById(conn.from);
                const toNode = document.getElementById(conn.to);
                
                if (!fromNode || !toNode) return;
                
                const fromRect = fromNode.getBoundingClientRect();
                const toRect = toNode.getBoundingClientRect();
                const containerRect = document.getElementById('diagram').getBoundingClientRect();
                
                const fromX = fromRect.left + fromRect.width / 2 - containerRect.left;
                const fromY = fromRect.top + fromRect.height / 2 - containerRect.top;
                const toX = toRect.left + toRect.width / 2 - containerRect.left;
                const toY = toRect.top + toRect.height / 2 - containerRect.top;
                
                // Crear l√≠nea
                const line = document.createElementNS(svgNS, 'line');
                line.setAttribute('x1', fromX);
                line.setAttribute('y1', fromY);
                line.setAttribute('x2', toX);
                line.setAttribute('y2', toY);
                line.setAttribute('stroke', '#cbd5e0');
                line.setAttribute('stroke-width', '2');
                line.setAttribute('opacity', '0.4');
                
                // Crear flecha
                const angle = Math.atan2(toY - fromY, toX - fromX);
                const arrowLength = 10;
                const arrowWidth = 6;
                
                const arrowX = toX - Math.cos(angle) * (toRect.width / 2 + 5);
                const arrowY = toY - Math.sin(angle) * (toRect.height / 2 + 5);
                
                const arrow = document.createElementNS(svgNS, 'polygon');
                const points = [
                    [arrowX, arrowY],
                    [arrowX - arrowLength * Math.cos(angle) - arrowWidth * Math.sin(angle), 
                     arrowY - arrowLength * Math.sin(angle) + arrowWidth * Math.cos(angle)],
                    [arrowX - arrowLength * Math.cos(angle) + arrowWidth * Math.sin(angle), 
                     arrowY - arrowLength * Math.sin(angle) - arrowWidth * Math.cos(angle)]
                ];
                
                arrow.setAttribute('points', points.map(p => p.join(',')).join(' '));
                arrow.setAttribute('fill', '#cbd5e0');
                arrow.setAttribute('opacity', '0.4');
                
                svg.appendChild(line);
                svg.appendChild(arrow);
            });
        }

        function selectNode(key) {
            document.querySelectorAll('.node').forEach(n => n.classList.remove('active'));
            document.getElementById(key).classList.add('active');
            
            const data = systemData[key];
            document.getElementById('info-title').textContent = data.title;
            document.getElementById('info-text').innerHTML = `
                <p><strong>${data.pcc ? '‚ö†Ô∏è Punto Cr√≠tico de Control' : 'üìç Componente del Sistema'}</strong></p>
                <p style="margin-top: 15px;">${data.description}</p>
                ${data.pcc ? '<p style="margin-top: 15px; padding: 10px; background: #fff5f5; border-left: 4px solid #f56565; border-radius: 5px;"><strong>Punto Cr√≠tico:</strong> Requiere monitoreo continuo y protocolos de control espec√≠ficos.</p>' : ''}
            `;
        }

        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('info-content').style.display = tab === 'info' ? 'block' : 'none';
            document.getElementById('stats-content').style.display = tab === 'stats' ? 'block' : 'none';
        }

        // Inicializar
        setTimeout(() => {
            drawConnections();
            selectNode('sistema-produccion');
        }, 100);

        window.addEventListener('resize', drawConnections);
    </script>
</body>
</html>
